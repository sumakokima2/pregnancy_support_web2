<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <title>test</title>
</head>
<style>
    /* General Styles */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 1%;
        background-color: #f9f9f9;
        overflow-y: auto;
        width: 98%;

        /* ページ全体でスクロールを有効に */
    }

    html,
    body {
        scroll-padding-top: 60px;
    }

    #container {
        display: flex;
    }

    #left {
        width: 20vw;
        height: 100vh;
        overflow-y: auto;
        padding: 0 10px
    }

    #sample1 {
        text-align: center;
        width: 98%;
    }

    #right {
        width: 80vw;
        height: 100vh;
        overflow-y: auto;
    }

    .tlans {
        display: inline-block;
        transform: rotate(180deg);
    }

    .non-tlans {
        display: inline-block;
        transform: rotate(0);
    }



    .langCng {
        padding: 10px;
        cursor: pointer;
        border-radius: 5px;
        background-color: #e0e0e0;
        margin: 5px 0;
        font-size: 14px;
        color: #333;
        transition: background-color 0.3s, color 0.3s;
    }

    .selected {
        background-color: #007bff !important;
        color: #fff !important;
    }

    .parent {
        background-color: #fff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
    }

    .item._A {
        flex: 1;
        padding-right: 10px;
        margin-bottom: 10px;
    }

    .item._B {
        flex: 3;
        display: flex;
        flex-wrap: wrap;
    }

    .buttonA {
        background-color: #007bff;
        color: #fff;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: background-color 0.3s;
    }

    .buttonA:hover {
        background-color: #0056b3;
    }

    .smallB {
        background-color: #f0f8ff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 8px;
        margin: 5px;
        cursor: pointer;
        flex: 1 1 calc(33.333% - 10px);
        text-align: center;
        transition: background-color 0.3s;
    }

    .smallB:hover {
        background-color: #e6f7ff;
    }

    .ja_text {
        font-size: 14px;
        font-weight: bold;
        color: #333;
    }

    .lan {
        font-size: 13px;
        color: #666;
        margin-top: 5px;
    }

    .buttonA p,
    .buttonA span {
        display: block;
        /* 各言語のテキストをブロック要素にし、改行 */
        margin: 0;
        /* 不要な余白を除去 */
    }


    .toggle-button {
        display: inline-block;
        position: relative;
        width: 100px;
        height: 50px;
        border-radius: 50px;
        background-color: #dddddd;
        cursor: pointer;
        transition: background-color .4s;
    }

    .toggle-button:has(:checked) {
        background-color: #d84b9b;
    }

    .toggle-button::after {
        position: absolute;
        top: 0;
        left: 0;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 0 5px rgb(0 0 0 / 20%);
        background-color: #fff;
        content: '';
        transition: left .4s;
    }

    .toggle-button:has(:checked)::after {
        left: 50px;
    }

    .toggle-button input {
        display: none;
    }

    .tbox {
        top: 0;
    }


    /* タブ全体のスタイル */
    .tabs {
        /* 横並びにする */
        border-bottom: 2px solid #ccc;
        /* 下線 */
        margin: 0;
        padding: 0;
    }

    /* 各タブのスタイル */
    .tab {
        list-style: none;
        /* 点を消す */
        padding: 10px 20px;
        cursor: pointer;
        /* カーソルをポインターに */
        border: 1px solid #ccc;
        border-bottom: none;
        /* 下線を消す */
        background-color: #f9f9f9;
        transition: background-color 0.3s;
    }

    /* ホバー時のスタイル */
    .tab:hover {
        background-color: #e0e0e0;
    }

    /* アクティブタブのスタイル */
    .tab.active {
        background-color: #ffffff;
        font-weight: bold;
        border-bottom: 2px solid #fff;
        /* 下線を背景と同じ色で消す */
    }

    .category {

        text-align: center;
        margin: 20px auto 20px;
        font-size: large;
        background-color: #ffd3e3;
        padding: 30px;
        font-weight: bold;
    }

    .accordion {
        max-width: 500px;
        margin-bottom: 7px;
        border: 2px solid #d0d0d0;
        border-radius: 5px;
    }

    .accordion summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        padding: 1em 2em;
        color: #333333;
        font-weight: 600;
        cursor: pointer;
    }

    .accordion summary::-webkit-details-marker {
        display: none;
    }

    .accordion summary::after {
        transform: translateY(-25%) rotate(45deg);
        width: 7px;
        height: 7px;
        margin-left: 10px;
        border-bottom: 3px solid #333333b3;
        border-right: 3px solid #333333b3;
        content: '';
        transition: transform .3s;
    }

    .accordion[open] summary::after {
        transform: rotate(225deg);
    }

    .accordion p {
        transform: translateY(-10px);
        opacity: 0;
        margin: 0;
        padding-left: 2em;
        color: #333333;
        transition: transform .5s, opacity .5s;
    }

    .accordion[open] p {
        transform: none;
        opacity: 1;
    }

    .counter {
        width: 99%;
        display: flex;
        justify-content: space-between;
        overflow-x: auto;
    }

    .counter p {
        padding: 18px;
        cursor: pointer;
        border-radius: 5px;
        background-color: #e0e0e0;
        margin: 5px 0;
        font-size: 14px;
        color: #333;
        transition: background-color 0.3s, color 0.3s;
    }

    .counter_tani {
        display: flex;
        justify-content: space-around;
        width: 105%;
    }

    .counter_tani p {
        padding: 5px;
        cursor: pointer;
        border-radius: 5px;
        background-color: #e0e0e0;
        margin: 5px 0;
        font-size: 14px;
        color: #333;
        transition: background-color 0.3s, color 0.3s;
    }
</style>

<body>
    <script>
        var categoryArray = [];
        var number = [
            ["〇times a day", "breakfast", "lunch", "dinner", "bedtime", "before", "after", "none"],
            ["每天〇次", "早餐", "午餐", "晚餐", "睡前", "之前", "之后", "无"],
            ["〇 Mal am Tag", "Frühstück", "Mittagessen", "Abendessen", "Schlafenszeit", "vorher", "nachher",
                "keine"
            ]
            ["〇 lần một ngày", "bữa sáng", "bữa trưa", "bữa tối", "trước khi ngủ", "trước", "sau", "không có"],
            ["〇 vezes por dia", "café da manhã", "almoço", "jantar", "antes de dormir", "antes", "depois",
                "nenhum"
            ],
            ["하루에 〇 번", "아침 식사", "점심 식사", "저녁 식사", "잠자기 전", "이전", "이후", "없음"],
            ["〇 beses sa isang araw", "almusal", "tanghalian", "hapunan", "bago matulog", "bago", "pagkatapos",
                "wala"
            ]
        ]
        var number1 = [
            // 英語
            ["hours ago", "days ago", "weeks ago", "times"],
            // 中国語
            ["小时前", "天前", "周前", "次"],
            // ドイツ語
            ["Stunden vorher", "Tage vorher", "Wochen vorher", "Mal"],
            // ベトナム語
            ["giờ trước", "ngày trước", "tuần trước", "lần"],
            // ポルトガル語
            ["horas atrás", "dias atrás", "semanas atrás", "vezes"],
            // 韓国語
            ["시간 전", "일 전", "주 전", "회"],
            // タガログ語
            ["oras ang nakalipas", "araw ang nakalipas", "linggo ang nakalipas", "beses"]
        ];

        var languageArray = ["en-US", "zh", "de", "ve", "pr", "ko", "tg"]
        var dataArray = []
        var localData = [];
        var enData = [];
        var zhData = [];
        var deData = [];
        var veData = [];
        var koData = [];
        var prData = [];
        var tgData = [];
        let indexLanguage;
        window.onload = function () {
            if ('speechSynthesis' in window) {
                alert("このブラウザは音声合成に対応しています")
            } else {
                alert("このブラウザは音声合成に対応していません")
            }
            var wDef = (navigator.browserLanguage || navigator.language || navigator.userLanguage).substr(0, 2);


            langSet("en-US");
        }

        function langSet(argLang) {
            categorycheck = []
            var elm = document.getElementsByClassName("langCng");
            for (var i = 0; i < elm.length; i++) {

                if (elm[i].getAttribute("lang") == argLang) {
                    elm[i].classList.add("selected")
                } else {
                    elm[i].classList.remove("selected")
                }

            }
            indexLanguage = languageArray.indexOf(argLang);
            createTable(dataArray[indexLanguage]);
        }

        function say(a) {
            console.log(a);
            const uttr = new SpeechSynthesisUtterance(a[0])
            uttr.lang = 'ja-JP';
            speechSynthesis.speak(uttr)
            const uttr2 = new SpeechSynthesisUtterance(a[1])
            uttr2.lang = languageArray[indexLanguage];
            speechSynthesis.speak(uttr2)
        }

        var categorycheck = []

        function createTable(d) {

            var len = localData.length;
            var html = '';
            for (var i = 0; i < len; i++) {
                var answer = "";

                if (localData[i].data[0] == "counter") {
                    var text = "";
                    for (var p = 1; p < 13; p++) {
                        text += "<p class ='ii'>" + p + "</p>"
                    }

                    answer += `
                    <div class = "counter">
                    ${text}
                    </div>

                    <div class = "counter_tani">
                    <p class ='ii'>時間前/${number1[indexLanguage][0]}</p>
                    <p class ='ii'>日前/${number1[indexLanguage][1]}</p>
                    <p class ='ii'>週間前/${number1[indexLanguage][2]}</p>
                    <p class ='ii'>回/${number1[indexLanguage][3]}</p>
                    </div>
                    `

                } else if (localData[i].data[0] == "number") {

                    answer += `<label for="timesPerDay">1日〇回/${number[indexLanguage][0]}：</label>
        <select id="timesPerDay" name="timesPerDay">
            <!-- 1〜10まで選択可能 -->
            <option value="" disabled selected>選択してください</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
        <br><br>

        <!-- 朝食 -->
        <fieldset>
            <legend>朝食/${number[indexLanguage][1]}</legend>
            <label>
                <input type="radio" name="breakfast" value="before"> 前/${number[indexLanguage][5]}
            </label>
            <label>
                <input type="radio" name="breakfast" value="after"> 後/${number[indexLanguage][6]}
            </label>
            <label>
                <input type="radio" name="breakfast" value="before"> 無し/${number[indexLanguage][7]}
            </label>
        </fieldset>

        <!-- 昼食 -->
        <fieldset>
            <legend>昼食/${number[indexLanguage][2]}</legend>
            <label>
                <input type="radio" name="lunch" value="before"> 前/${number[indexLanguage][5]}
            </label>
            <label>
                <input type="radio" name="lunch" value="after"> 後/${number[indexLanguage][6]}
            </label>
            <label>
                <input type="radio" name="breakfast" value="before"> 無し/${number[indexLanguage][7]}
            </label>
        </fieldset>

        <!-- 夕食 -->
        <fieldset>
            <legend>夕食/${number[indexLanguage][3]}</legend>
            <label>
                <input type="radio" name="dinner" value="before"> 前/${number[indexLanguage][5]}
            </label>
            <label>
                <input type="radio" name="dinner" value="after"> 後/${number[indexLanguage][6]}
            </label>
            <label>
                <input type="radio" name="breakfast" value="before"> 無し/${number[indexLanguage][7]}
            </label>
        </fieldset>

        <!-- 就寝時 -->
        <fieldset>
            <legend>就寝時/${number[indexLanguage][4]}</legend>
            <label>
                <input type="radio" name="bedtime" value="before"> 前/${number[indexLanguage][5]}
            </label>
            <label>
                <input type="radio" name="bedtime" value="after"> 後/${number[indexLanguage][6]}
            </label>
            <label>
                <input type="radio" name="bedtime" value="before"> 無し/${number[indexLanguage][7]}
            </label>
        </fieldset>`

                } else {
                    for (var j = 0; j < localData[i].data.length; j++) {
                        if (localData[i].data[j].length > 0) {
                            answer +=
                                `<div class="smallB" id="B${i}-${j}" ><p class="lan tlans"  >${d[i].data[j]}</p><p class="ja_text">${localData[i].data[j]}</p></div>`
                        }
                    }
                }

                if (categorycheck.indexOf(localData[i].type) == -1) {
                    var id = categorycheck.length
                    html += `<div id = "category${id}" class="category">${localData[i].type}</div>`
                    var id1 = categoryArray.indexOf(localData[i].type)
                    categorycheck.push(localData[i].type)
                }

                if (localData[i].category) {
                    html += `<div class="parent">
                    <div class ="item _A"><div class = "buttonA" id = "A${i}"><span class="tlans">${d[i].category}</span><p class="">${localData[i].category}</p></div></div>
                    <div class ="item _B">${answer}</div>
                    </div>`;
                }
                //localData[i].category + ' ' + localData[i].data1 + '<br>';



                document.getElementById('whole').innerHTML = html;
                // クリックイベントの設定
                // クリックイベントの設定
                // "ii" クラスを持つ要素を取得
                const elements = document.getElementsByClassName("ii");

                // 各要素にクリックイベントを設定
                for (let i = 0; i < elements.length; i++) {
                    elements[i].addEventListener("click", function (event) {
                        // クリックされた要素に "selected" クラスをトグル
                        event.target.classList.toggle("selected");
                    });
                }

            }



            for (let i = 0; i < len; i++) {

                let elemId = `A${i}`;
                let elem = document.getElementById(elemId);
                if (elem) {
                    elem.onclick = function () {
                        say([localData[i].category, d[i].category]);
                    };
                }

                for (let j = 0; j < 6; j++) {
                    let elemId = `B${i}-${j}`;
                    let elem = document.getElementById(elemId);
                    if (elem) {
                        elem.onclick = function () {
                            say([localData[i].data[j], d[i].data[j]]);
                        };
                    }

                }
            }

        }

        //https://script.google.com/macros/s/AKfycbyOlGXRp2fgyV4AaGxFobqrsGSpg68Nfnz2joCmznrp87vD3F1swBU-SEniFppKSm0UzQ/exec
        async function getDataFromGAS(sheetName) {
            const url =
                `https://script.google.com/macros/s/AKfycbyOlGXRp2fgyV4AaGxFobqrsGSpg68Nfnz2joCmznrp87vD3F1swBU-SEniFppKSm0UzQ/exec?sheet=${sheetName}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                const convertedData = data.map(item => ({
                    type: item.type,
                    type2: item.type2,
                    category: item.category,
                    data: [
                        item.data1,
                        item.data2,
                        item.data3,
                        item.data4,
                        item.data5,
                        item.data6,
                        item.data7
                    ]
                }));
                if (sheetName == "enData") {
                    createTable(convertedData);

                }
                return convertedData; // 非同期処理の結果を返す
            } catch (error) {
                console.error("Error fetching data:", error);
                return null; // エラー時はnullを返す
            }
        }

        var detailArray = []
        async function fetchData() {
            localData = await getDataFromGAS('localData');
            for (var i = 0; i < localData.length; i++) {
                categoryArray.push(localData[i].type)
            }
            categoryArray = Array.from(new Set(categoryArray));

            for (let i in categoryArray) {
                var array = []
                detailArray[categoryArray[i]] = array
            }

            for (var i = 0; i < localData.length; i++) {
                var array =
                    detailArray[localData[i].type].push(localData[i].type2)
            }

            for (let i in detailArray) {
                detailArray[i] = Array.from(new Set(detailArray[i]));
            }

            var tab = `<select id="categorySelect">
             <option value="">カテゴリを選択</option>`;
            for (var i = 0; i < categoryArray.length; i++) {
                tab += `<option value="category${i}">${categoryArray[i]}</option>`;
            }
            tab += `</select>`;
            document.getElementById("tab").innerHTML = tab;

            // セレクトボックスのイベント設定
            document.getElementById("categorySelect").addEventListener("change", function () {
                var target = this.value;
                if (target) {
                    location.hash = target; // 該当カテゴリーにスクロール
                }
            });

            console.log(categoryArray)


            zhData = await getDataFromGAS('zhData');
            deData = await getDataFromGAS('deData');
            enData = await getDataFromGAS('enData');
            prData = await getDataFromGAS('pr');
            koData = await getDataFromGAS('ko');
            veData = await getDataFromGAS('ve');
            tgData = await getDataFromGAS('tg');

            console.log(localData); // 取得したデータを確認
            console.log(enData);
            console.log(zhData);
            console.log(deData);

            dataArray.push(enData)
            dataArray.push(zhData)
            dataArray.push(deData)
            dataArray.push(veData)
            dataArray.push(prData)
            dataArray.push(koData)
            dataArray.push(tgData)

        }

        fetchData(); // データを取得して使用する
    </script>
    <div id="container">
        <div id="left">
            <div class="tbox"><label class="toggle-button">
                    <input type="checkbox" id="toggleSwitch" />
                </label>
                <p class="tlans">向きを変える</p>
            </div>
            <div id="sample1">
                <div class="langCng en selected" lang="en-US" onClick="langSet('en-US')">英語/English</div>
                <div class="langCng zh" lang="zh" onClick="langSet('zh')">中国語/中文</div>
                <div class="langCng de" lang="de" onClick="langSet('de')">ドイツ語/Deutsch</div>
                <div class="langCng ve" lang="ve" onClick="langSet('ve')">ベトナム語/Tiếng Việt</div>
                <div class="langCng pr" lang="pr" onClick="langSet('pr')">ポルトガル語/Português</div>
                <div class="langCng ko" lang="ko" onClick="langSet('ko')">韓国語/한국어</div>
                <div class="langCng tg" lang="tg" onClick="langSet('tg')">タガログ語/Tagalog</div>


            </div>
        </div>
        <div id="right">
            <div id="tab">
            </div>
            <div id="whole">
            </div>
        </div>
    </div>

    <script>
        // トグルスイッチの状態を取得
        const toggleSwitch = document.getElementById("toggleSwitch");

        toggleSwitch.addEventListener("change", () => {

            if (toggleSwitch.checked) {
                const elements = document.querySelectorAll(".tlans");
                elements.forEach(element => {

                    element.classList.remove("tlans");
                    element.classList.add("non-tlans");
                });
            } else {
                const elements = document.querySelectorAll(".non-tlans");
                elements.forEach(element => {
                    element.classList.remove("non-tlans");
                    element.classList.add("tlans");
                });
            }
        });
    </script>
</body>

</html>
